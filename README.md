# csa_lab4
- Кузнецов Кирилл P3230
- `lisp | cisc | neum | mc | tick | binary | stream | mem | cstr | prob1 | superscalar`
## Язык программирования
### Синтаксис
```
<program> ::= <expr>*

<expr> ::= <integer>
         | <string>
         | <list-expr>
         | <identifier>

<list-expr> ::= "(" <operator> <expr>* ")"
              | "(" "if" <expr> <expr> <expr>? ")"
              | "(" "let" "(" <binding>* ")" <expr>* ")"
              | "(" "setq" <identifier> <expr> ")"
              | "(" "loop" ("while" <expr>)? <expr>* ")"
              | "(" "defun" <identifier> "(" <identifier>* ")" <expr> ")"
              | "(" ")"

<operator> ::= "+" | "-" | "*" | "/" | "mod" | "and" | "or"
             | "<" | ">=" | "=" | "!=" | ">" | "<="
             | "not" | "print" | "concat" | "list" | "car" | "cdr"
             | "null" | "push" | "nreverse" | "read" | "input-string"
             | <identifier>  ; вызов функции

<binding> ::= "(" <identifier> <expr> ")"

<integer> ::= цифровая константа
<string> ::= '"' последовательность-символов '"'
<identifier> ::= последовательность символов, не включающая пробелы и специальные символы
```
### Семантика 
- Стратегия вычисления - рекурсивная (транслируется сначала вычисление операндов)
- Префиксная нотация (сначала оператор)
- Область видимости: переменные доступны только внутри блока, где были объявлены, хранятся на стеке
- Передача аргументов через стек
- Возврат всех значений через регистр R0: напрямую для численных, по ссылке для списков и строк
- Возврат типа значения в R1: 0 - для числа, 1 - для строки
- Операции
- - (+, -, *, /, mod, and, or) - произвести арифмитическую/логическую операцию над всеми операндами
  -  (>, >=, =, !=, >, <=) - произвести операцию сравнениях операндов
  -  not - вернуть 0, если операнд != 0, иначе 1
  -  print - вывести число или строку
  -  concat - конкатенация двух строк (создается новая, возвращается ссылка на нее)
  -  read - читается одно машинное слово из ввода
  -  input-string - читается и сохраняется строка, как массив машинных слов
  -  list - создается список из целочисленных элементов, возвращается ссылка на него
  -  null - проверить пустой ли список
  -  car - вернуть первый элемент списка, вернется в R0
  -  cdr - вернуть ссылку на второй элемент списка
  -  push - добавить элемент в начало списка и вернуть на него ссылку
  -  nreverse - развернуть список, создается новый список и возвращается ссылка на него
## Организация памяти
 - Архитектура фон Неймана.
 - Память адресуется побайтово.
 - Размер машинного слова - **32 бита**
 - ### Инструкции переменной длины:
 - - 2 байта - REG2REG адрессация (пример ADD R1, R2)
   - 4 байта - косвенная относительная адрессация - `[REG + n]` (`ADD R1, [R15 + 4]`), (`STORE [R15 + 4], R1`); а также адрессация смещением PC `PC + OFFSET` (`JMP 16`)
   - 6 байт - непосредственная адрессация (`ADD R1, 10`)
 - ### Разделы памяти
   - Инструкции хранятся в области `.text` (начинается с 0), причем 
       - В конце секции находятся все объявленные функции, а также все функции стандартные для языке
       - Программа завершается инструкцией `HALT`
       - Функции завершаются RET reg, где reg - регистр возврата
   - Константные строки данные хранятся в `.data` (идет сразу за `.text`), числовые константы, а также константные списки отсутствуют
   - Динамические строки, списки хранятся в `heap` (начианя с 0x3000), куча никогда не очищается, растет вверх
     Ссылки и числовые значения переменных хранятся на стеке, а также все аргументы перед вызовом функции, растет "вниз"
         `0x0000` ┌───────────────┐  
                  │  Текст (код)  │  
         `0x....` ├───────────────┤  
                  │    Данные     │  
         `0x....` ├───────────────┤  
                  │     Куча      │  ↓ (`R13`)  
         `0x3000` ├───────────────┤  
                  │     Стек      │  ↑ (`R15`)  
         `0xFFFF` └───────────────┘
   - ### Регистры
   - `R0`,...,`R15` - регистры общего назначения: при трансляции `R15` используется, как указатель стека, `R14` - как регистр возврата, `R13` - heap pointer
   - `AR` - 4 байта
   - `DR` - 4 байта
   - `IR` - 2 байта
   - `PC` - 4 байта
   - `mPC` 
